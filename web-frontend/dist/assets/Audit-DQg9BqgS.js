import{b as y,c as w,r as a,j as e}from"./index-DFD28I4s.js";function S(){const{token:b}=y(),{isAdmin:d}=w(),[n,i]=a.useState(!1),[o,x]=a.useState(null),[r,g]=a.useState([]),[N,f]=a.useState(0),[l,p]=a.useState(1),[u]=a.useState(20),[t,h]=a.useState({userId:"",action:""}),m=async()=>{i(!0),x(null);try{const s=new URLSearchParams({page:l.toString(),limit:u.toString()});t.userId&&s.append("userId",t.userId),t.action&&s.append("action",t.action);const c=await fetch(`/api/audit/logs?${s}`,{headers:{Authorization:`Bearer ${b}`}});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const j=await c.json();g(j.logs),f(j.total)}catch(s){x(s.message||"Failed to load audit logs")}finally{i(!1)}};return a.useEffect(()=>{d()&&m()},[l,t,d]),d()?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 sm:p-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold mb-4",children:"Audit Logs"}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"text",placeholder:"Filter by User ID",value:t.userId,onChange:s=>h({...t,userId:s.target.value}),className:"border px-3 py-2 rounded text-sm flex-1"}),e.jsx("input",{type:"text",placeholder:"Filter by Action",value:t.action,onChange:s=>h({...t,action:s.target.value}),className:"border px-3 py-2 rounded text-sm flex-1"}),e.jsx("button",{onClick:m,disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded text-sm whitespace-nowrap",children:n?"Loading...":"Search"})]}),o&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:o}),r.length===0?e.jsx("p",{className:"text-gray-500",children:"No audit logs found"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"py-2 px-1",children:"Time"}),e.jsx("th",{className:"px-1",children:"User"}),e.jsx("th",{className:"px-1",children:"Action"}),e.jsx("th",{className:"px-1",children:"Resource"}),e.jsx("th",{className:"px-1 hidden sm:table-cell",children:"IP Address"}),e.jsx("th",{className:"px-1 hidden lg:table-cell",children:"Status"})]})}),e.jsx("tbody",{children:r.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 px-1 whitespace-nowrap",children:new Date(s.created_at).toLocaleString()}),e.jsxs("td",{className:"px-1 font-mono text-xs",children:[s.user_id.slice(0,8),"..."]}),e.jsx("td",{className:"px-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.action.includes("LOGIN")||s.action.includes("REGISTER")?"bg-blue-100 text-blue-800":s.action.includes("ROLE")?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:s.action})}),e.jsx("td",{className:"px-1 text-xs",children:s.resource_type&&e.jsxs("span",{children:[s.resource_type,s.resource_id&&e.jsxs("span",{className:"font-mono ml-1",children:["(",s.resource_id.slice(0,8),"...)"]})]})}),e.jsx("td",{className:"px-1 hidden sm:table-cell text-xs",children:s.ip_address}),e.jsx("td",{className:"px-1 hidden lg:table-cell",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.success?"Success":"Failed"})})]},s.id))})]})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",r.length," of ",N," logs"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(Math.max(1,l-1)),disabled:l===1,className:"px-3 py-1 border rounded text-sm disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm",children:["Page ",l]}),e.jsx("button",{onClick:()=>p(l+1),disabled:r.length<u,className:"px-3 py-1 border rounded text-sm disabled:opacity-50",children:"Next"})]})]})]})]})}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-500",children:"You don't have permission to view audit logs."})]})}export{S as default};
