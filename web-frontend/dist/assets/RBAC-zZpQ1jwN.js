import{b as P,r,j as e}from"./index-DFD28I4s.js";import{h as i}from"./client-C7ulCTuc.js";function E(){const{token:p}=P(),[d,x]=r.useState("roles"),[b,R]=r.useState([]),[j,w]=r.useState([]),[o,t]=r.useState(!1),[v,l]=r.useState(null),[n,c]=r.useState({name:"",description:"",permissions:[]}),[h,y]=r.useState(""),[g,N]=r.useState(""),f=["product:read","product:create","product:update","product:delete","inventory:read","inventory:adjust","inventory:transfer","sale:read","sale:create","sale:update","sale:delete","sale:refund","user:read","user:create","user:update","user:delete","role:manage","report:read","report:export","settings:read","settings:update","admin:full"];r.useEffect(()=>{p&&m()},[p]);const m=async()=>{t(!0),l(null);try{const[s,a]=await Promise.all([i.listRoles(),i.listUsers()]);R(s.data||[]),w(a.data||[])}catch(s){l(s.message||"Failed to load RBAC data")}finally{t(!1)}},C=async()=>{if(!n.name||!n.description){l("Name and description are required");return}t(!0);try{await i.createRole(n),c({name:"",description:"",permissions:[]}),m()}catch(s){l(s.message||"Failed to create role")}finally{t(!1)}},S=async()=>{if(!h||!g){l("Please select both user and role");return}t(!0);try{await i.assignRole(h,{roleId:g}),y(""),N(""),m()}catch(s){l(s.message||"Failed to assign role")}finally{t(!1)}},A=async(s,a)=>{t(!0);try{await i.removeRole(s,a),m()}catch(u){l(u.message||"Failed to remove role")}finally{t(!1)}},k=s=>{c(a=>({...a,permissions:a.permissions.includes(s)?a.permissions.filter(u=>u!==s):[...a.permissions,s]}))};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"RBAC Management"}),v&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:v}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>x("roles"),className:`py-2 px-1 border-b-2 font-medium text-sm ${d==="roles"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Roles"}),e.jsx("button",{onClick:()=>x("users"),className:`py-2 px-1 border-b-2 font-medium text-sm ${d==="users"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Users"}),e.jsx("button",{onClick:()=>x("permissions"),className:`py-2 px-1 border-b-2 font-medium text-sm ${d==="permissions"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Permissions"})]})}),o&&e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"text-gray-500",children:"Loading..."})}),!o&&d==="roles"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Create New Role"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Role Name",value:n.name,onChange:s=>c(a=>({...a,name:s.target.value})),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",placeholder:"Description",value:n.description,onChange:s=>c(a=>({...a,description:s.target.value})),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Permissions:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:f.map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.permissions.includes(s),onChange:()=>k(s),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:s})]},s))})]}),e.jsx("button",{onClick:C,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Create Role"})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Existing Roles"}),e.jsx("div",{className:"space-y-4",children:b.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:s.description}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Permissions: "}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.permissions.map(a=>e.jsx("span",{className:"bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded",children:a},a))})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.is_active?"Active":"Inactive"})]})},s.id))})]})]}),!o&&d==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Assign Role to User"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("select",{value:h,onChange:s=>y(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select User"}),j.map(s=>e.jsxs("option",{value:s.id,children:[s.email," (",s.first_name," ",s.last_name,")"]},s.id))]}),e.jsxs("select",{value:g,onChange:s=>N(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Role"}),b.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.description]},s.id))]})]}),e.jsx("button",{onClick:S,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Assign Role"})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"User Roles"}),e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.email}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[s.first_name," ",s.last_name]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Roles: "}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.roles.map(a=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:a.name},a.id))})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.is_active?"Active":"Inactive"})]}),s.roles.length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>A(s.id,s.roles[0].id),className:"text-red-600 hover:text-red-800 text-sm",children:["Remove ",s.roles[0].name," role"]})})]},s.id))})]})]}),!o&&d==="permissions"&&e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Available Permissions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3",children:e.jsx("code",{className:"text-sm font-mono text-blue-600",children:s})},s))})]})]})}export{E as default};
